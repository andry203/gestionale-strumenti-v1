<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{% block title %}Gestionale{% endblock %}</title>
  </head>

  <header style="display: flex; justify-content: space-between; align-items: center; padding: 0.5em 1em; background: #f5f5f5;">
    <div class="logo">
      <a href="{{ url_for('auth.homepage') }}"><strong>Gestionale Strumenti</strong></a>
    </div>
  
    <div class="header-right">
      {% if not current_user.is_authenticated %}

        <form action="{{ url_for('auth.login') }}" method="post" style="display: inline-block; margin-right: 1em;">
          <input name="email" type="email" placeholder="Email" required style="margin-right:0.5em;">
          <input name="password" type="password" placeholder="Password" required style="margin-right:0.5em;">
          <input type="hidden" name="next" value="{{ request.path }}">
          <button type="submit">Login</button>
        </form>
        <a href="{{ url_for('auth.register') }}">Non sei registrato? Registrati qui.</a>

      {% else %}

        <span style="margin-right:1em;">Ciao, {{ current_user.email }}.</span>
        <a href="{{ url_for('auth.logout') }}" style="margin-right:1em;">Logout</a>

        <form action="{{ url_for('auth.delete_account') }}" method="post" style="display:inline;"
            onsubmit="return confirm('Sei sicuro di voler eliminare il tuo account? Questa operazione Ã¨ irreversibile.');">
          <button type="submit" style="background:none;border:none;padding:0;color:#007bff;cursor:pointer;">
            Elimina account
          </button>
        </form>
      {% endif %}
    </div>
  </header>
  

  <body>
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        <ul id="flashes">
          {% for cat, msg in msgs %}
            <li class="{{ cat }}">{{ msg }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}

    <!-- JS script for flash messages -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const flashContainer = document.getElementById('flashes');
        if (!flashContainer) return;
        // Dopo 3 secondi fai scomparire gradualmente
        setTimeout(() => {
          // puoi fare direttamente display:none oppure una dissolvenza via JS/CSS
          flashContainer.style.transition = 'opacity 0.5s ease';
          flashContainer.style.opacity = '0';
          // dopo la dissolvenza, rimuovi il contenitore per non occupare spazio
          setTimeout(() => flashContainer.remove(), 500);
        }, 3000);
      });
    </script>

  </body>
</html>
